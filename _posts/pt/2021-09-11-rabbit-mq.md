---
layout: post
title: Messagens com RabbitMQ! ‚úâÔ∏è
category: posts
lang: pt
tags: [dev, study, messaging, queue, rabbit]
image: /assets/img/posts/queue.png
accent_image: 
  background: url('/assets/img/projects/rabbitmq.png') center/10%
  overlay: true
description: >
  Como criar um template de dotnet core para ser utilizado via linha de comando ou visual studio.
invert_sidebar: false
---

Muito tempo atr√°s, na minha faculdade, fiz uma apresenta√ß√£o, o tema era livre e poderia escolher uma tecnologia que estivesse em alta para falar sobre, na √©poca a tecnologia escolhida foi sobre mensagerias, estava come√ßando a estudar sobre arquitetura de micro-servi√ßos e me deparei com esse incr√≠vel tema, recentemente o github come√ßou a me alertar de algumas vulnerabilidades que surgiram no projeto (desenvolvido em NodeJS), ent√£o decidi aproveitar para atualizar e escrever um pouco sobre ele.

Mas antes de come√ßar, gostaria de falar o porqu√™ surgiram e qual a utilidade das mensagerias, em sistemas de distribuidos e de larga escala, um dos problemas que √© preciso resolver √© o de comunica√ß√£o, antes de mensagerias j√° existiam tanto o http e o tcp, por√©m existe um problema que esses protocolos n√£o resolvem, que √© a garantia de entrega, voc√™ pode enviar dados a outro sistema, por√©m se voc√™ precisa garantir que a mensagem seja recebida voc√™ mesmo precisa desenvolver a l√≥gica de retry, timeout, semaphore entre outras.

Al√©m disso, caso voc√™ precise enviar para diversos servicos o mesmo evento ou caso utilize uma infraestrutura de kubernetes por exemplo que permita derrubar n√≥s, subir novos e escalar f√°cilmente, saber para onde enviar essa mensagem pode se tornar algo muito complexo.

Para solu√ß√£o desses problemas √© poss√≠vel utilizar servi√ßos de mensageria, com elas voc√™ pode customizar de acordo com o seu uso, e entre elas o RabbitMQ √© bastante flexiv√©l e de f√°cil configura√ß√£o.

Primeiro vamos falar como subir uma inst√¢ncia do RabbitMQ local (em sua m√°quina), isso facilita muito no desenvolvimento pois ser√° nosso laborat√≥rio para testes, e uma ferramenta que ajuda muito nisso √© o docker, ha diversos tutoriais de instala√ß√£o do docker, ele √© totalmente compativel com Windows, Mac ou Linux üêß. Ap√≥s instalado √© poss√≠vel subir o RabbitMQ com ~~PASMEM~~ __um un√≠co comando__!

```
docker run --rm -it --hostname my-rabbit -p 15672:15672 -p 5672:5672 rabbitmq:3-management
```

Nele basicamente estamos falando que:
  - Caso j√° exista um docker com Rabbit rodando, excluir e subir novamente,
  - Define a vers√£o e portas que precisam ser abertas
  - 'Attacha' o terminal a essa instancia, para ver o status de cria√ß√£o e acompanhar em tempo real o que acontece.

Agora vem a parte interessante ~~na minha opini√£o~~ da apresenta√ß√£o, clonando o reposit√≥rio: [queue-exemples](https://github.com/luigihenrick/queue-exemples) e rodando os seguintes comandos:

```
npm install
npm start
```

Vamos iniciar a aplica√ß√£o na porta 8080, nela criei um html simples que servia para os outros alunos acessarem e avaliar a apresenta√ß√£o, mas at√© a√≠ nada demais, certo?
A diferen√ßa est√° que, o servidor que vai processar esse request a principio est√° desligado, ent√£o todas as avalia√ß√µes dadas por outros alunos s√£o enviadas mas at√© ent√£o n√£o s√£o entregues a nenhum lugar, ap√≥s todos avaliarem, tudo que precisamos fazer √© subir o servidor que esta dentro da pasta `/app` do mesmo reposit√≥rio executando o comando `node queue-server.js` e sim, todo o servidor est√° escrito em um arquivo s√≥, NodeJS pode ser muito impressionante...

![Queue Server](/assets/img/posts/queue-server.png "RabbitMQ Server")